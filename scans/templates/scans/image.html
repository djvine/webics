{% extends 'webics/base.html' %}

{% block title %}
{{ title }}
{% endblock %}

{% block extra_head %}
{% load staticfiles %}
<link href="{% static 'webics/js/image_plot.css' %}" rel="stylesheet">
<script src="{% static 'webics/d3/d3.v3.js' %}"></script>
<script src="{% static 'webics/js/socket.io.js' %}"></script>
<script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
<script src="{% static 'webics/js/img.js' %}"></script>
<script src="{% static 'webics/js/image_plot.js' %}"></script>
<script src="{% static 'webics/js/detector_select.js' %}"></script>
{% endblock %}

{% block content %}
{% load staticfiles %}

<br>

<div class="col-lg-6">
<div id="test_image1" class="lImage" style="width:100%;height:400px"></div>
</div>
<div class="col-lg-6">
<div id="test_image2" class="lImage" style="width:100%;height:400px"></div>
</div>

<div class='col-lg-4' >
  <h4>Scan History</h4>
  <table id="scan_history" class="table-condensed table-striped">

    <thead>
      <tr> 
        <th>Show</th>
          <th>Time</th>  
          <th>Scan ID</th>
          <th>1D</th>
          <th>2D</th> 
      </tr>
    </thead>
    <tbody>

      {% for scan in recent_scans %}
      <tr>
        <td><button type="button" class="scan_sel btn {% if forloop.first %}btn-success{% else %}btn-primary{% endif %} btn-xs" id="{{ scan.scan_id }}"><span class="glyphicon glyphicon-play"></span></button></td>
        <td>{{ scan.ts|date:"D d M H:i" }}</td>
        <td>{{ scan.scan_id }}</td>
        {% for hist in scan.history.all %}
        <td>{{ hist.completed }}/{{ hist.requested }}</td>
        {% endfor %}
      </tr>
      {% empty %}
      <tr>
          <td>No scans yet.</td>
      </tr>
      {% endfor %}

    </tbody>

  </table>
</div>
<div class='col-lg-4'>
  <h4 class="text-center">Select Detectors</h4>
  
  {% for det in dets %}
  {% if det == 'D01' or det == 'D08' or det == 'D15' or det == 'D22' or det == 'D29' or det == 'D36' or det == 'D43' or det == 'D50' or det == 'D57' or det == 'D64'%}
  <div class='detrows text-center'>
  {% endif %}
    <button onclick="toggle_state(this.id)" type="button" class="btn btn-primary btn-xs" id="{{ det }}">{{ det }}</button>
  {% if det == 'D07' or det == 'D14' or det == 'D21' or det == 'D28' or det == 'D35' or det == 'D42' or det == 'D49' or det == 'D56' or det == 'D63' or det == 'D70'%}
  </div>
  {% endif %}
  {% endfor %}
</div>

<div class='col-lg-4'>
  <h4  class="text-center">Chat</h4>
  <div>
    <div class="span2" id="chat-people">
        <ul id="people" class="unstyled"></ul>
    </div>
    <div class="span4" id="chat-messages">
        <ul id="msgs" class="unstyled">
    </div>
  </div>
  <div>
      <div class="span5 offset2" id="login">
          <form class="form-inline">
                <input type="text" class="input-small" placeholder="Your name" id="name">
              <input type="button" name="join" id="join" value="Join" class="btn btn-primary">
          </form>
      </div>

      <div class="span5 offset2" id="chat">
          <form id="2" class="form-inline">
                <input type="text" class="input" placeholder="Your message" id="msg">
              <input type="button" name="send" id="send" value="Send" class="btn btn-success">
          </form>
        <button type="button" class="btn btn-default" id="broadcast" onclick="onbroadcast(this.id)">Broadcast</button>
      </div>
   </div>
</div>

<script type="text/javascript">
  updateActiveDetectors(['D01', 'D05']); // For sample data
  update_row_button_state()
</script>

<script type="text/javascript"> 
  var beamline = "{{ active_tab }}"
  var i1 = new ImagePlot({containerId: 'test_image1', data: data1, det: 'D01'});
  var i2 = new ImagePlot({containerId: 'test_image2', data: data1, det: 'D05'});
</script>
<script src="{% static 'webics/js/image_client.js' %}"></script>

{% endblock %}



